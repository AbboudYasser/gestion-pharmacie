# Ù…Ù„Ù GitHub Actions Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ÙŠÙ†Ø´Ø¦ config.js Ø«Ù… ÙŠØ¨Ù†ÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
name: ğŸš€ Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Ø¯Ù…Ø¬ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
  build-and-deploy:
    name: ğŸ”¨ Build and Deploy
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
      
    steps:
    # 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    # 2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù config.js Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø§Ø±
    - name: ğŸ¤« Create config.js from Secrets
      run: |
        echo "ğŸ” Creating config.js file from GitHub Secrets..."
        mkdir -p frontend/js
        # ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø±Ø§Ø±
            - name: ğŸ¤« Create config.js from Secrets
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
        mkdir -p frontend/js

        # ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø± ÙÙŠ Ù…Ù„Ù config.js
        # Ù„Ø§Ø­Ø¸ Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… secrets.* Ù„ÙƒÙ„ Ø´ÙŠØ¡ Ø§Ù„Ø¢Ù†
        echo "const SUPABASE_URL = '${{ secrets.SUPABASE_URL }}';" > frontend/js/config.js
        echo "const SUPABASE_ANON_KEY = '${{ secrets.SUPABASE_ANON_KEY }}';" >> frontend/js/config.js
        echo "const SUPABASE_PROJECT_ID = '${{ secrets.SUPABASE_PROJECT_ID }}';" >> frontend/js/config.js
        echo "const EMAILJS_SERVICE_ID = '${{ secrets.EMAILJS_SERVICE_ID }}';" >> frontend/js/config.js
        echo "const EMAILJS_TEMPLATE_ID = '${{ secrets.EMAILJS_TEMPLATE_ID }}';" >> frontend/js/config.js
        echo "const EMAILJS_PUBLIC_KEY = '${{ secrets.EMAILJS_PUBLIC_KEY }}';" >> frontend/js/config.js

        echo "const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);" >> frontend/js/config.js
        echo "console.log('âœ… Supabase config loaded successfully from secrets.');" >> frontend/js/config.js
        echo "âœ… config.js created successfully."

    # 3. Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Pages (Ø®Ø·ÙˆØ© ØªØ­Ø¶ÙŠØ±ÙŠØ©)
    - name: âš™ï¸ Setup Pages
      uses: actions/configure-pages@v5

    # 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ù†Ø³Ø® Ù…Ø­ØªÙˆÙŠØ§Øª frontend Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø´Ø±
    # âœ¨âœ¨âœ¨ Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ø³Ù…Ø© Ø§Ù„ØªÙŠ Ø£Ø¹ÙŠØ¯Øª âœ¨âœ¨âœ¨
    - name: ğŸ—ï¸ Build Project by copying frontend contents
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø°ÙŠ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ GitHub Pages
        mkdir -p _site
        
        # Ù†Ø³Ø® ÙƒÙ„ Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ø¬Ù„Ø¯ frontend (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ config.js Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡) Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø´Ø±
        cp -r frontend/* _site/
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .nojekyll Ù„Ù…Ù†Ø¹ GitHub Ù…Ù† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒÙ…Ø¯ÙˆÙ†Ø© Jekyll
        touch _site/.nojekyll

    # 5. Ø±ÙØ¹ Ù†Ø§ØªØ¬ Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙƒÙ€ "artifact" Ù„Ù€ GitHub Pages
    - name: ğŸ“¤ Upload Artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './_site'

    # 6. Ù†Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ GitHub Pages
    - name: ğŸš€ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
